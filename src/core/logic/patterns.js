/* eslint-disable consistent-return, no-restricted-syntax,padded-blocks,no-multi-spaces,key-spacing,comma-dangle,max-len,no-mixed-operators,curly,comma-spacing,comma-style,no-useless-computed-key */

/**
 * World of WarCraft: Assertions Enabled Build (build 3368) <-- 0.5.3
 * World of WarCraft: Assertions Enabled Build (build 3734) <-- 0.8.0
 * World of WarCraft (build 4735)                           <-- 1.8.0
 * World of WarCraft (build 5875)                           <-- 1.12.1
 */

export const getVersion = (Memory) => {

  const build = Memory.findStrPattern(' (build ');
  const buildStr = new Buffer(0xE);
  if (build.length === 0) return;
  const versionPtr = build[0];
  Memory.readData(versionPtr, buildStr, buildStr.byteLength);
  const buildFound = buildStr.toString('ascii').match(/\d/g).join('');
  console.log('# WoW Build Found', buildFound);
  if (buildFound === '3368') return { client: 'alpha', build: '0.5.3' };
  if (buildFound === '3734') return { client: 'alpha', build: '0.8.0' };
  if (buildFound === '4735') return { client: 'vanilla', build: '1.8.0' };
  if (buildFound === '5875') return { client: 'vanilla', build: '1.12.0' };
  if (buildFound === '8606') return { client: 'tbc', build: '2.4.3' };
  if (buildFound === '12340') return { client: 'wlk', build: '3.3.5a' };
  if (buildFound === '15595') return { client: 'ctl', build: '4.3.4' };
};

export const vanilla = {
  camera: {
    pattern: new Buffer([0x8B, 0x10, 0x8D, 0x4E, 0x08, 0x89, 0x11, 0x8B, 0x50, 0x04, 0x89, 0x51, 0x04, 0x8B, 0x40, 0x08, 0x89, 0x41, 0x08]),
    fix:     new Buffer([0x8B, 0x10, 0x8D, 0x4E, 0x08, 0x90, 0x90, 0x8B, 0x50, 0x04, 0x90, 0x90, 0x90, 0x8B, 0x40, 0x08, 0x90, 0x90, 0x90]),
    base: {
      pattern: new Buffer([0x8B ,0x11 ,0x8D ,0x45 ,0xF4 ,0x50 ,0xFF ,0x52
        ,0x04 ,0x8B ,0x4D ,0xF4 ,0x8B ,0x55 ,0xF8 ,0x8B ,0x45 ,0xFC ,0x89
        ,0x0E ,0x89 ,0x56 ,0x04 ,0x89 ,0x46 ,0x08 ,0x5E ,0x8B ,0xE5 ,0x5D]),
      patternFix: -0xD,
      version: {
        ['1.8.0']: {
          ptrFix: [0x6570, 0]
        },
        ['1.12.0']: {
          ptrFix: [0x65B8, 0]
        }
      }
    }
  },
  cameraViewMatrix: {
    version: {
      ['1.8.0']: {
        pattern: new Buffer([0xE8, 0x5F, 0xF1, 0xE6, 0xFF, 0xB9, 0x09, 0x00, 0x00, 0x00, 0x8D, 0xB5, 0x60, 0xFF, 0xFF, 0xFF, 0xF3, 0xA5]),
        fix:     new Buffer([0xE8, 0x5F, 0xF1, 0xE6, 0xFF, 0xB9, 0x09, 0x00, 0x00, 0x00, 0x8D, 0xB5, 0x60, 0xFF, 0xFF, 0xFF, 0x90, 0x90])
      },
      ['1.12.0']: {
        pattern: new Buffer([0xE8, 0x0F, 0x97, 0xE3, 0xFF, 0xB9, 0x09, 0x00, 0x00, 0x00, 0x8D, 0xB5, 0x60, 0xFF, 0xFF, 0xFF, 0xF3, 0xA5]),
        fix:     new Buffer([0xE8, 0x0F, 0x97, 0xE3, 0xFF, 0xB9, 0x09, 0x00, 0x00, 0x00, 0x8D, 0xB5, 0x60, 0xFF, 0xFF, 0xFF, 0x90,  0x90])
      }
    }
  }
};

export const alpha = {
  camera: {
    pattern: new Buffer([0x89, 0x02, 0xD9, 0x5D, 0xF8, 0x8B,
      0x4D, 0xF8, 0xDD, 0xD8, 0x89, 0x4A, 0x04, 0xDD, 0xD8,
      0xD9, 0x45, 0xF0, 0xD8, 0x65, 0xE4, 0xD9, 0x5D, 0xFC,
      0xD9, 0x86, 0xD4, 0x00, 0x00, 0x00, 0x8B, 0x45, 0xFC,
      0xD8, 0x65, 0x08, 0x89, 0x42, 0x08]),
    fix:     new Buffer([0x90, 0x90, 0xD9, 0x5D, 0xF8, 0x8B,
      0x4D, 0xF8, 0xDD, 0xD8, 0x90, 0x90, 0x90, 0xDD, 0xD8,
      0xD9, 0x45, 0xF0, 0xD8, 0x65, 0xE4, 0xD9, 0x5D, 0xFC,
      0xD9, 0x86, 0xD4, 0x00, 0x00, 0x00, 0x8B, 0x45, 0xFC,
      0xD8, 0x65, 0x08, 0x90, 0x90, 0x90]),
    base: {
      pattern: new Buffer([0xC6, 0x83, 0x88, 0x00, 0x00, 0x00, 0x00, 0x8B,
        0x7D, 0x0C, 0x8B, 0xC3, 0xC1, 0xE8, 0x10, 0x66, 0x89, 0x45, 0xFC,
        0x66, 0xC7, 0x45, 0xFE, 0x6D, 0x6F, 0x8B, 0x4D, 0xFC, 0x89, 0x4B,
        0x0C]),
      patternFix: 0x22,
      version: {
        ['0.5.3']: {
          ptrFix: 0x3D4
        },
        ['0.8.0']: {
          ptrFix: 0x6C
        }
      }
    }
  },
  cameraViewMatrix: {
    version: {
      ['0.5.3']: {
        pattern: new Buffer([0x8D, 0x8D, 0x70, 0xFF, 0xFF, 0xFF, 0xE8, 0x34, 0x5E, 0xFA, 0xFF, 0xB9, 0x09, 0x00, 0x00, 0x00, 0x8D, 0xB5, 0x70, 0xFF, 0xFF, 0xFF, 0xF3, 0xA5]),
        fix:     new Buffer([0x8D, 0x8D, 0x70, 0xFF, 0xFF, 0xFF, 0xE8, 0x34, 0x5E, 0xFA, 0xFF, 0xB9, 0x09, 0x00, 0x00, 0x00, 0x8D, 0xB5, 0x70, 0xFF, 0xFF, 0xFF, 0x90, 0x90])
      },
      ['0.8.0']: {
        pattern: new Buffer([0xE8, 0x94, 0x80, 0xFA, 0xFF, 0xB9, 0x09, 0x00, 0x00, 0x00, 0x8D, 0xB5, 0x70, 0xFF, 0xFF, 0xFF, 0xF3, 0xA5]),
        fix:     new Buffer([0xE8, 0x94, 0x80, 0xFA, 0xFF, 0xB9, 0x09, 0x00, 0x00, 0x00, 0x8D, 0xB5, 0x70, 0xFF, 0xFF, 0xFF, 0x90, 0x90])
      }
    }
  }
};

export const tbc = {
  SpectatePointer: [0x00871B94, 0xCC, 0x49C],
  CameraPointer: [0x00C6ECCC, 0x732c, 0],
  EnableSpectate: new Buffer([0x00, 0x00, 0x7F, 0x43]),
  DisableSpectate: new Buffer([0, 0, 0, 0]),
  CameraValuesPointer: 0x00CEF468,
  Collision: 0x48,
  Speed: 0x44,
  cameraViewMatrix: {
    version: {
      ['2.4.3']: {
        pattern: new Buffer([0xD9, 0x40, 0x1C, 0xD9, 0x5D, 0xE4, 0xD9, 0x40, 0x08, 0xD9, 0x5D, 0xE8, 0xD9, 0x40, 0x14, 0xD9, 0x5D, 0xEC, 0xD9, 0x40, 0x20, 0xD9, 0x5D, 0xF0, 0xF3, 0xA5]),
        fix:     new Buffer([0xD9, 0x40, 0x1C, 0xD9, 0x5D, 0xE4, 0xD9, 0x40, 0x08, 0xD9, 0x5D, 0xE8, 0xD9, 0x40, 0x14, 0xD9, 0x5D, 0xEC, 0xD9, 0x40, 0x20, 0xD9, 0x5D, 0xF0, 0x90, 0x90])
      }
    }
  }
};

export const wlk = {
  SpectatePointer: [0x006DB754, 0x38, 0x98, 0x240],
  CameraPointer: [0xB7436C, 0x7e20, 0],
  EnableSpectate: new Buffer([0x00, 0x00, 0x7F, 0x43]),
  DisableSpectate: new Buffer([0, 0, 0, 0]),
  CameraValuesPointer: 0x00ACE4A8,
  Collision: 0x48,
  Speed: 0x44,
  cameraViewMatrix: {
    version: {
      ['3.3.5a']: {
        pattern: new Buffer([0xD9, 0x40, 0x1C, 0xD9, 0x5D, 0xE4, 0xD9, 0x40, 0x08, 0xD9, 0x5D, 0xE8, 0xD9, 0x40, 0x14, 0xD9, 0x5D, 0xEC, 0xD9, 0x40, 0x20, 0xD9, 0x5D, 0xF0, 0xF3, 0xA5]),
        fix:     new Buffer([0xD9, 0x40, 0x1C, 0xD9, 0x5D, 0xE4, 0xD9, 0x40, 0x08, 0xD9, 0x5D, 0xE8, 0xD9, 0x40, 0x14, 0xD9, 0x5D, 0xEC, 0xD9, 0x40, 0x20, 0xD9, 0x5D, 0xF0, 0x90, 0x90])
      }
    }
  }
};

export const ctl = {
  SpectatePointer: 0x163BEC,
  CameraPointer: [0x013F7A10, 0x80D0, 0],
  EnableCorrectKeyboardControls: 0x94, // I would like to know one day why 4.3.4 is so "special"
  EnableSpectate: new Buffer([0xBA, 0x00, 0x00, 0x48, 0x00, 0xC1, 0xEA, 0x13, 0xF6, 0xC2, 0x01, 0x74, 0x18, 0xC1, 0xE9, 0x16, 0xF6, 0xC1, 0x01, 0x75, 0x0A, 0x85, 0xC0, 0x74, 0x0C, 0x83, 0x78, 0x08, 0x00, 0x75, 0x06, 0xB8, 0x01, 0x00, 0x00, 0x00, 0xC3, 0xB8, 0x01, 0x00, 0x00, 0x00, 0xC3, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC]),
  DisableSpectate: new Buffer([0x8B, 0x49, 0x08, 0x8B, 0xD1, 0xC1, 0xEA, 0x13, 0xF6, 0xC2, 0x01, 0x74, 0x18, 0xC1, 0xE9, 0x16, 0xF6, 0xC1, 0x01, 0x75, 0x0A, 0x85, 0xC0, 0x74, 0x0C, 0x83, 0x78, 0x08, 0x04, 0x75, 0x06, 0xB8, 0x01, 0x00, 0x00, 0x00, 0xC3, 0x33, 0xC0, 0xC3, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC, 0xCC]),
  EnableSpectateOnCam: new Buffer([2, 0x00, 0x00, 0x0]),
  DisableSpectateOnCam: new Buffer([0, 0, 0, 0]),
  CameraValuesPointer: 0x012319A0,
  Collision: 0x48,
  Speed: 0x44,
  cameraViewMatrix: {
    version: {
      ['4.3.4']: {
        pattern: new Buffer([0xF3, 0x0F, 0x11, 0x55, 0xB0, 0xF3, 0x0F, 0x11, 0x4D, 0xBC, 0xF3, 0x0F, 0x11, 0x45, 0xC0, 0xF3, 0x0F, 0x11, 0x65, 0xC4, 0xF3, 0x0F, 0x11, 0x5D, 0xC8, 0xF3, 0xA5]),
        fix:     new Buffer([0xF3, 0x0F, 0x11, 0x55, 0xB0, 0xF3, 0x0F, 0x11, 0x4D, 0xBC, 0xF3, 0x0F, 0x11, 0x45, 0xC0, 0xF3, 0x0F, 0x11, 0x65, 0xC4, 0xF3, 0x0F, 0x11, 0x5D, 0xC8, 0x90, 0x90])
      }
    }
  },
};
